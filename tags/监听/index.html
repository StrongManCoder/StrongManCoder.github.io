<!DOCTYPE html>

<html lang="zh-Hans">

<head>
  
  <title>Tags：监听 - 70Qiang</title>
  <meta charset="UTF-8">
  <meta name="description" content="随心 随笔 随想">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png" />
  <meta name="description" content="随心 随笔 随想">
<meta property="og:type" content="website">
<meta property="og:title" content="70Qiang">
<meta property="og:url" content="http://yoursite.com/tags/%E7%9B%91%E5%90%AC/index.html">
<meta property="og:site_name" content="70Qiang">
<meta property="og:description" content="随心 随笔 随想">
<meta property="og:locale">
<meta property="article:author" content="70Qiang">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/theme-nexmoe/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,gh/theme-nexmoe/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css?v=233" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1616568501324">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="70Qiang" class="mdui-btn mdui-btn-icon"><img src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/avatar.png" alt="70Qiang"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="70Qiang">
            <img src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/avatar.png" alt="70Qiang" alt="70Qiang">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>7</div>
        <div><span>Tags</span>14</div>
        <div><span>Categories</span>0</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="Search"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/20238211" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/nexmoe/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  

  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/BAT/" style="font-size: 10px;">BAT</a> <a href="/tags/GitHub/" style="font-size: 10px;">GitHub</a> <a href="/tags/KVC/" style="font-size: 10px;">KVC</a> <a href="/tags/KVO/" style="font-size: 10px;">KVO</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/OC/" style="font-size: 10px;">OC</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/iOS%E6%B5%8B%E8%AF%95%E5%8C%85/" style="font-size: 10px;">iOS测试包</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%A4%B9%E6%9D%83%E9%99%90/" style="font-size: 10px;">文件夹权限</a> <a href="/tags/%E7%9B%91%E5%90%AC/" style="font-size: 10px;">监听</a> <a href="/tags/%E9%9B%86%E9%94%A6/" style="font-size: 10px;">集锦</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">面试</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
    
  </div>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 70Qiang
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <section class="nexmoe-posts">
    
    <div class="nexmoe-post">
        <a href="/2016/09/13/KVO%E5%B0%8F%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="KVO小记" class="lazyload">
                    <h1>KVO小记</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2016年09月13日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.2k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 5 分钟</a>
        </div>

        <article>
            
                <h1 id="KVO浅析"><a href="#KVO浅析" class="headerlink" title="KVO浅析"></a>KVO浅析</h1><h3 id="KVO-Key-Value-Observing-键值监听"><a href="#KVO-Key-Value-Observing-键值监听" class="headerlink" title="KVO Key-Value Observing 键值监听"></a>KVO Key-Value Observing 键值监听</h3><p>KVO是一个观察者模式。观察一个对象的属性，注册一个指定的路径，若这个对象的的属性修改，则KVO会自动通知观察者。</p>
<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="1-注册监听"><a href="#1-注册监听" class="headerlink" title="1.注册监听"></a>1.注册监听</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">     *  注册一个监听</span><br><span class="line">     *</span><br><span class="line">     *  @param observer 观察者</span><br><span class="line">     *  @param keyPath  属性名字</span><br><span class="line">     *  @param options  属性的变化</span><br><span class="line">     *  @param context  void类型</span><br><span class="line">     */</span><br><span class="line">- (void)addObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath options:(NSKeyValueObservingOptions)options context:(nullable void *)context;</span><br></pre></td></tr></table></figure>
<h3 id="2-回调函数"><a href="#2-回调函数" class="headerlink" title="2.回调函数"></a>2.回调函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> *  当监控的某个属性的值改变了就会调用</span><br><span class="line"> *</span><br><span class="line"> *  @param keyPath 属性名（哪个属性改了？）</span><br><span class="line"> *  @param object  哪个对象的属性被改了？</span><br><span class="line"> *  @param change  属性的修改情况（属性原来的值、属性最新的值）</span><br><span class="line"> *  @param context void类型</span><br><span class="line"> */</span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;%@对象的%@属性改变了：%@&quot;, object, keyPath, change);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-移除观察-释放内存，在dealloc函数释放"><a href="#3-移除观察-释放内存，在dealloc函数释放" class="headerlink" title="3.移除观察,释放内存，在dealloc函数释放"></a>3.移除观察,释放内存，在dealloc函数释放</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> *  移除观察者</span><br><span class="line"> *</span><br><span class="line"> *  @param observer 观察者</span><br><span class="line"> *  @param keyPath  观察的属性</span><br><span class="line"> */</span><br><span class="line">- (void)removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath;</span><br><span class="line">- (void)removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath context:(nullable void *)context NS_AVAILABLE(10_7, 5_0);</span><br></pre></td></tr></table></figure>
<p>KVO的观察者是由两种模式的。一种是自动通知，一种是手动通知。<br><strong>自动通知</strong>自动监听对象的属性，不管这个属性的前后属性变化的值是否一样，都会通知观察者。<br>手动通知重写willChangeValueForKey:和didChangeValueForKey: 方法通知观察者。<br>一般都是用自动通知，方便快捷。<br>下面两种写法，都会举例说明。</p>
<h3 id="自动通知-主要看监听回调的分析"><a href="#自动通知-主要看监听回调的分析" class="headerlink" title="自动通知,主要看监听回调的分析"></a>自动通知,主要看监听回调的分析</h3><p>场景：模拟人年龄的变化，看接受通知的次数</p>
<figure class="highlight plain"><figcaption><span>(void)viewDidLoad &#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">    [super viewDidLoad];</span><br><span class="line"></span><br><span class="line">    self.person = [[Person alloc]init];</span><br><span class="line">    self.person.age = 15;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  注册监听</span><br><span class="line">     */</span><br><span class="line">    [self.person addObserver:self forKeyPath:@&quot;age&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil];</span><br><span class="line">    /**</span><br><span class="line">     *  第二次赋值 20</span><br><span class="line">     */</span><br><span class="line">    self.person.age = 20;</span><br><span class="line">    /**</span><br><span class="line">     *  再次赋值 20</span><br><span class="line">     */</span><br><span class="line">    self.person.age = 20;</span><br><span class="line">    /**</span><br><span class="line">     *  详细见控制台输出,只比较新旧值</span><br><span class="line">     */    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  监听回调</span><br><span class="line"> */</span><br><span class="line">-(void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context&#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;\n change = %@ \n keyPath =%@ object =%@ context=%@&quot;,change ,keyPath,object,context);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /** ============================ 控制台输出 ===================================</span><br><span class="line">     * </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     change = &#123;</span><br><span class="line">     kind = 1;</span><br><span class="line">     new = 20;        ---------&gt;新的值是 20 注册监听后，observeValueForKeyPath会回调输出</span><br><span class="line">     old = 15;        ---------&gt;旧的值是 15 注册监听前，这个属性初始化时候就是15。</span><br><span class="line">     &#125;</span><br><span class="line">     keyPath =age object =&lt;Person: 0x7feec962a9d0&gt; context=(null)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     change = &#123;</span><br><span class="line">     kind = 1;</span><br><span class="line">     new = 20;        ---------&gt;新的值是 20 再次传入20，observeValueForKeyPath这个还是会回调输出</span><br><span class="line">     old = 20;        ---------&gt;旧的值是 20</span><br><span class="line">     &#125;</span><br><span class="line">     keyPath =age object =&lt;Person: 0x7feec962a9d0&gt; context=(null)</span><br><span class="line"></span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  由控制台输出结果得出结论，只要是对属性进行改变，不管属性的值是否变化，不区分新旧值的变化，observeValueForKeyPath都是回调，通知观察者的。</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(void)dealloc&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  移除观察</span><br><span class="line">     */</span><br><span class="line">    [self.person removeObserver:self forKeyPath:@&quot;age&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="手动通知"><a href="#手动通知" class="headerlink" title="手动通知"></a>手动通知</h3><p>场景：模拟人年龄的变化，看接受通知的次数<br>需要在Person类里面重写方法，具体看实现代码</p>
<figure class="highlight plain"><figcaption><span>(void)viewDidLoad &#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    [super viewDidLoad];</span><br><span class="line"></span><br><span class="line">    self.person = [[Person alloc]init];</span><br><span class="line">    self.person.age = 15;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  注册监听</span><br><span class="line">     */</span><br><span class="line">    [self.person addObserver:self forKeyPath:@&quot;age&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil];</span><br><span class="line">    /**</span><br><span class="line">     *  第二次赋值 20</span><br><span class="line">     */</span><br><span class="line">    self.person.age = 20;</span><br><span class="line">    /**</span><br><span class="line">     *  再次赋值 20</span><br><span class="line">     */</span><br><span class="line">    self.person.age = 20;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  详细见控制台输出,只比较新旧值</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  监听回调</span><br><span class="line"> */</span><br><span class="line">-(void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context&#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;\n change = %@ \n keyPath =%@ object =%@ context=%@&quot;,change ,keyPath,object,context);</span><br><span class="line"></span><br><span class="line">    /** ============================ 控制台输出 ===================================</span><br><span class="line">     * </span><br><span class="line">     change = &#123;</span><br><span class="line">     kind = 1;</span><br><span class="line">     new = 20;        ---------&gt;新的值是 20 注册监听后，observeValueForKeyPath会回调输出</span><br><span class="line">     old = 15;        ---------&gt;旧的值是 15 注册监听前，这个属性初始化时候就是15。</span><br><span class="line">     &#125;</span><br><span class="line">     keyPath =age object =&lt;Person: 0x7feec962a9d0&gt; context=(null)</span><br><span class="line"></span><br><span class="line">     */</span><br><span class="line">   /**</span><br><span class="line">     *  和自动通知输出作对比，这样明白理解。主要是在Person类里面重写了 automaticallyNotifiesObserversForKey 这个方法。以及重写age的setter方法</span><br><span class="line">     *  由控制台输出结果得出结论，只要监听对象的属性值前后发生改变，observeValueForKeyPath就回调，通知观察者的。</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)dealloc&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  移除观察</span><br><span class="line">     */</span><br><span class="line">    [self.person removeObserver:self forKeyPath:@&quot;age&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Person类的实现"><a href="#Person类的实现" class="headerlink" title="Person类的实现"></a>Person类的实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//  Person.m</span><br><span class="line">//  KVO</span><br><span class="line">//</span><br><span class="line">//  Created by XXXXXX on 15/11/9.</span><br><span class="line">//  Copyright © 2015年 Simon. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;Person.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line">-(void)setAge:(float)age&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  判断两值是否一样，一样就不复赋值了</span><br><span class="line">     */</span><br><span class="line">    if (_age!= age) &#123;</span><br><span class="line">        [self willChangeValueForKey:@&quot;age&quot;];</span><br><span class="line"></span><br><span class="line">        _age = age;</span><br><span class="line"></span><br><span class="line">        [self didChangeValueForKey:@&quot;age&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  是否对这个key开启自动发送通知</span><br><span class="line"> *</span><br><span class="line"> *  @param theKey 监听的属性key</span><br><span class="line"> *</span><br><span class="line"> *  @return 布尔值</span><br><span class="line"> */</span><br><span class="line">+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)theKey &#123;</span><br><span class="line">    BOOL automatic = NO;</span><br><span class="line"></span><br><span class="line">    if ([theKey isEqualToString:@&quot;age&quot;])</span><br><span class="line">    &#123;</span><br><span class="line">        automatic = NO;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        automatic=[super automaticallyNotifiesObserversForKey:theKey];</span><br><span class="line">    &#125;</span><br><span class="line">    return automatic;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>观察了自动通知和手动通知，各有所长，看你们喜欢哪个。记住手动通知必须重写方法，只有新旧值前后不一样才会通知。自动通知就不管新旧值是否一样，都说告诉观察者。</strong><br>实现原理可以参考这个博客，写的很详细.<br><a href="http://blog.csdn.net/kesalin/article/details/8194240" target="_blank" rel="noopener">[深入浅出Cocoa]详解键值观察（KVO）及其实现机理</a></p>

            
        </article>
    </div>
    
</section>

        <div class="nexmoe-post-right">
          <div class="nexmoe-fixed">
            <div class="nexmoe-tool">
              <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
            </div>
          </div>
        </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>
 

<script src="/js/app.js?v=1616568501325"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





</body>

</html>
